<header class="app-header">
  <div class="brand">
    <span class="brand-mark">TI</span>
    <span class="brand-text">The Index</span>
  </div>

  <nav class="nav-links" aria-label="Primary">
    @for (item of navItems; track item.label) {
      @if (item.children?.length) {
        <div class="nav-group">
          <button
            class="nav-link nav-trigger"
            type="button"
            [class.is-active]="isParentActive(item)"
            [attr.aria-expanded]="isSubmenuOpen(item)"
            (click)="toggleSubmenu(item)"
          >
            {{ item.label }}
          </button>

          @if (isSubmenuOpen(item)) {
            <div class="subnav-panel">
              @for (child of item.children; track child.route) {
                <a
                  [routerLink]="child.route"
                  routerLinkActive="is-active"
                  class="subnav-link"
                  (click)="closeMenu()"
                >
                  {{ child.label }}
                </a>
              }
            </div>
          }
        </div>
      } @else {
        <a
          [routerLink]="item.route"
          routerLinkActive="is-active"
          class="nav-link"
          (click)="closeMenu()"
        >
          {{ item.label }}
        </a>
      }
    }
  </nav>

  <div class="actions">
    <button class="logout-button" type="button" (click)="handleLogout()">Log out</button>
    <button
      class="menu-toggle"
      type="button"
      aria-label="Toggle navigation"
      [attr.aria-expanded]="isMenuOpen"
      (click)="toggleMenu()"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>

<div class="mobile-panel" [class.is-open]="isMenuOpen">
  <nav class="mobile-nav" aria-label="Mobile">
    @for (item of navItems; track item.label) {
      @if (item.children?.length) {
        <button
          class="nav-link nav-trigger"
          type="button"
          [class.is-active]="isParentActive(item)"
          [attr.aria-expanded]="isSubmenuOpen(item)"
          (click)="toggleSubmenu(item)"
        >
          {{ item.label }}
        </button>

        @if (isSubmenuOpen(item)) {
          <div class="mobile-subnav">
            @for (child of item.children; track child.route) {
              <a
                [routerLink]="child.route"
                routerLinkActive="is-active"
                class="subnav-link"
                (click)="closeMenu()"
              >
                {{ child.label }}
              </a>
            }
          </div>
        }
      } @else {
        <a
          [routerLink]="item.route"
          routerLinkActive="is-active"
          class="nav-link"
          (click)="closeMenu()"
        >
          {{ item.label }}
        </a>
      }
    }
    <button class="logout-button" type="button" (click)="handleLogout()">Log out</button>
  </nav>
</div>

<main class="layout-content" (click)="closeMenu()">
  <router-outlet></router-outlet>
</main>
