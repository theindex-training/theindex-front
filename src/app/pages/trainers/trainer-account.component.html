<section class="page">
  <header class="page-header">
    <div>
      <h1>Create trainer account</h1>
      <p>Provision login credentials for the selected trainer.</p>
    </div>
    <a class="button button-ghost" routerLink="/trainers">Back to trainers</a>
  </header>

  @if (loading) {
    <div class="state">Loading trainer...</div>
  } @else if (errorMessage && !trainer) {
    <div class="state error">{{ errorMessage }}</div>
  } @else if (trainer) {
    <div class="card">
      <div class="details">
        <div>
          <span class="label">Trainer</span>
          <strong>{{ trainer.name }}</strong>
        </div>
        <div>
          <span class="label">Nickname</span>
          <strong>{{ formatNickname() }}</strong>
        </div>
        <div>
          <span class="label">Status</span>
          <strong>{{ trainer.isActive ? 'Active' : 'Inactive' }}</strong>
        </div>
      </div>

      @if (trainer.accountId) {
        <div class="state">This trainer already has an account linked.</div>
      } @else {
        <form class="form" [formGroup]="form" (ngSubmit)="handleSubmit()">
          <div class="form-grid">
            <label class="field">
              <span>Email</span>
              <input type="email" formControlName="email" placeholder="trainer@example.com" />
              @if (form.controls.email.touched && form.controls.email.invalid) {
                <small class="error">Enter a valid email address.</small>
              }
            </label>

            <label class="field">
              <span>Status</span>
              <select formControlName="status">
                @for (option of statusOptions; track option.value) {
                  <option [value]="option.value">{{ option.label }}</option>
                }
              </select>
            </label>

            <label class="field">
              <span>Password</span>
              <div class="password-field">
                <input [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="Minimum 8 characters" />
                <button
                  type="button"
                  class="password-toggle"
                  [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
                  [title]="showPassword ? 'Hide password' : 'Show password'"
                  (click)="togglePasswordVisibility()"
                >
                  {{ showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                </button>
              </div>
              @if (form.controls.password.touched && form.controls.password.invalid) {
                <small class="error">Password must be at least 8 characters.</small>
              }
            </label>

            <label class="field">
              <span>Confirm password</span>
              <div class="password-field">
                <input [type]="showConfirmPassword ? 'text' : 'password'" formControlName="confirmPassword" placeholder="Repeat password" />
                <button
                  type="button"
                  class="password-toggle"
                  [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
                  [title]="showConfirmPassword ? 'Hide password' : 'Show password'"
                  (click)="toggleConfirmPasswordVisibility()"
                >
                  {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
                </button>
              </div>
              @if (form.controls.confirmPassword.touched && form.controls.confirmPassword.invalid) {
                <small class="error">Confirmation must be at least 8 characters.</small>
              }
              @if (showPasswordMismatch) {
                <small class="error">Passwords do not match.</small>
              }
            </label>
          </div>

          @if (errorMessage) {
            <div class="state error">{{ errorMessage }}</div>
          }

          <div class="form-actions">
            <button class="button button-primary" type="submit" [disabled]="submitting">
              {{ submitting ? 'Provisioning...' : 'Create account' }}
            </button>
          </div>
        </form>
      }
    </div>
  }
</section>
