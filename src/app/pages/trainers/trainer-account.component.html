<section class="page">
  <header class="page-header">
    <div>
      <h1>{{ isEditMode ? 'Manage trainer account' : 'Create trainer account' }}</h1>
      <p>
        {{
          isEditMode
            ? 'Update login credentials for this trainer account.'
            : 'Provision login credentials for the selected trainer.'
        }}
      </p>
    </div>
    <a class="button button-ghost" routerLink="/trainers">Back to trainers</a>
  </header>

  @if (loading) {
    <div class="state">Loading trainer...</div>
  } @else if (errorMessage && !trainer) {
    <div class="state error">{{ errorMessage }}</div>
  } @else if (trainer) {
    <div class="card">
      <div class="details">
        <div>
          <span class="label">Trainer</span>
          <strong>{{ trainer.name }}</strong>
        </div>
        <div>
          <span class="label">Nickname</span>
          <strong>{{ formatNickname() }}</strong>
        </div>
        <div>
          <span class="label">Profile status</span>
          <strong>{{ trainer.isActive ? 'Active' : 'Inactive' }}</strong>
        </div>
      </div>

      <form class="form" [formGroup]="form" (ngSubmit)="handleSubmit()">
        <div class="form-grid">
          <label class="field">
            <span>Email</span>
            <input type="email" formControlName="email" placeholder="trainer@example.com" />
            @if (form.controls.email.touched && form.controls.email.invalid) {
              <small class="error">Enter a valid email address.</small>
            }
          </label>

          <label class="field">
            <span>{{ isEditMode ? 'New password (optional)' : 'Password' }}</span>
            <div class="password-field">
              <input
                [type]="showPassword ? 'text' : 'password'"
                formControlName="password"
                [placeholder]="isEditMode ? 'Leave blank to keep current password' : 'Minimum 8 characters'"
              />
              <button
                type="button"
                class="password-toggle"
                [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
                [title]="showPassword ? 'Hide password' : 'Show password'"
                (click)="togglePasswordVisibility()"
              >
                {{ showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
          </label>

          <label class="field">
            <span>{{ isEditMode ? 'Confirm new password' : 'Confirm password' }}</span>
            <div class="password-field">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                [placeholder]="isEditMode ? 'Repeat new password if changed' : 'Repeat password'"
              />
              <button
                type="button"
                class="password-toggle"
                [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
                [title]="showConfirmPassword ? 'Hide password' : 'Show password'"
                (click)="toggleConfirmPasswordVisibility()"
              >
                {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
              </button>
            </div>
            @if (showPasswordLengthError) {
              <small class="error">Password fields must contain at least 8 characters.</small>
            }
            @if (showPasswordMismatch) {
              <small class="error">Passwords do not match.</small>
            }
          </label>
        </div>

        @if (errorMessage) {
          <div class="state error">{{ errorMessage }}</div>
        }

        <div class="form-actions">
          @if (isEditMode) {
            <button
              class="button button-danger"
              type="button"
              [disabled]="deactivating"
              (click)="deactivateAccount()"
            >
              {{ deactivating ? 'Deactivating...' : 'Deactivate account' }}
            </button>
          }
          <button class="button button-primary" type="submit" [disabled]="submitting">
            {{ submitting ? 'Saving...' : isEditMode ? 'Save account changes' : 'Create account' }}
          </button>
        </div>
      </form>
    </div>
  }
</section>
